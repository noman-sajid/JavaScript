<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volcano Run: 2D Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Segoe UI', sans-serif; }
        #ui-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            display: flex; flex-direction: column; justify-content: space-between;
            padding: 30px; box-sizing: border-box;
            z-index: 10;
        }
        .hud-top { display: flex; justify-content: space-between; align-items: flex-start; }
        #stats-container { text-align: right; }
        .heart { color: #ff3333; font-size: 32px; filter: drop-shadow(0 0 10px rgba(255,0,0,0.8)); }
        #score-label { font-size: 4rem; font-weight: 900; color: white; margin: 0; line-height: 1; font-style: italic; }
        #best-label { font-size: 1rem; color: #ffaa00; font-weight: bold; text-transform: uppercase; letter-spacing: 2px; }
        
        #game-over {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(20, 0, 0, 0.98);
            color: white;
            padding: 60px;
            border-radius: 40px;
            text-align: center;
            display: none;
            border: 3px solid #ff4500;
            box-shadow: 0 0 100px rgba(255, 69, 0, 0.4);
            z-index: 100;
            pointer-events: auto;
        }
        button {
            background: linear-gradient(135deg, #ff4500, #ff0000);
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 1.4rem;
            font-weight: bold;
            border-radius: 60px;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.2s;
            text-transform: uppercase;
        }
        button:hover { transform: scale(1.1); box-shadow: 0 0 20px #ff4500; }
        canvas { display: block; }
    </style>
</head>
<body>
    <div id="ui-overlay">
        <div class="hud-top">
            <div>
                <h1 style="color: #ff4500; margin: 0; font-style: italic; letter-spacing: -2px; font-size: 2.5rem;">VOLCANO RUN 2D</h1>
                <p style="color: rgba(255,255,255,0.7); margin: 5px 0;">ARROWS or WASD to Run | SPACE to Jump</p>
            </div>
            <div id="stats-container">
                <div id="hearts"><span class="heart">❤</span> <span class="heart">❤</span> <span class="heart">❤</span></div>
                <div id="score-label">0</div>
                <div id="best-label">Best: 0</div>
            </div>
        </div>
    </div>

    <div id="game-over">
        <h1 style="font-size: 4rem; margin: 0; color: #ff2200;">BURNED!</h1>
        <p style="opacity: 0.8; font-size: 1.2rem;">You couldn't handle the heat.</p>
        <div style="margin: 40px 0;">
            <div style="font-size: 1rem; text-transform: uppercase; color: #ffaa00;">High Score</div>
            <div id="final-score" style="font-size: 3.5rem; font-weight: bold;">0</div>
        </div>
        <button onclick="resetGame()">RESPAWN</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        /**
         * LEVEL REGISTRY (Twist): Modular design for new levels
         * Add a new object here to change theme, colors, and difficulty.
         */
        const LEVEL_THEMES = {
            VOLCANO: {
                bg: 0x1a0500,
                lava: 0xff2200,
                platform: 0x333333,
                accent: 0xff4500,
                gravity: 42,
                jumpPower: 16
            },
            ICE: {
                bg: 0x001a33,
                lava: 0x00ffff,
                platform: 0xffffff,
                accent: 0x00aaff,
                gravity: 30,
                jumpPower: 14
            }
        };

        let currentTheme = LEVEL_THEMES.VOLCANO;
        let scene, camera, renderer, player, playerVisual;
        let moveLeft = false, moveRight = false, canJump = false;
        let velocity = new THREE.Vector2(0, 0);
        let platforms = [];
        let score = 0, hearts = 3, bestScore = 0;
        let gameActive = true;
        let nextPlatformX = 0;
        let prevTime = performance.now();

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(currentTheme.bg);
            scene.fog = new THREE.FogExp2(currentTheme.bg, 0.05);

            // 2D Orthographic-feel Perspective Camera
            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 4, 15);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            document.body.appendChild(renderer.domElement);

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
            scene.add(ambientLight);

            const sunLight = new THREE.DirectionalLight(0xffffff, 0.8);
            sunLight.position.set(5, 10, 7);
            scene.add(sunLight);

            createPlayer();
            createLava();
            spawnInitialPlatforms();
            setupEventListeners();
            
            animate();
        }

        function createPlayer() {
            player = new THREE.Group();
            playerVisual = new THREE.Group();

            // Voxel Character Design
            const body = new THREE.Mesh(
                new THREE.BoxGeometry(0.7, 0.9, 0.5),
                new THREE.MeshStandardMaterial({ color: 0x2244ff })
            );
            body.position.y = 0.45;
            playerVisual.add(body);

            const head = new THREE.Mesh(
                new THREE.BoxGeometry(0.5, 0.5, 0.5),
                new THREE.MeshStandardMaterial({ color: 0xffdbac })
            );
            head.position.y = 1.15;
            playerVisual.add(head);

            player.add(playerVisual);
            player.position.set(0, 2, 0);
            scene.add(player);
        }

        function createLava() {
            const lavaGeo = new THREE.BoxGeometry(2000, 2, 10);
            const lavaMat = new THREE.MeshStandardMaterial({ 
                color: currentTheme.lava, 
                emissive: currentTheme.lava,
                emissiveIntensity: 1.5 
            });
            lava = new THREE.Mesh(lavaGeo, lavaMat);
            lava.position.y = -2;
            scene.add(lava);

            // Background "Wall" to make it feel 2D
            const bgGeo = new THREE.PlaneGeometry(2000, 100);
            const bgMat = new THREE.MeshStandardMaterial({ color: 0x050100 });
            const backWall = new THREE.Mesh(bgGeo, bgMat);
            backWall.position.z = -5;
            scene.add(backWall);
        }

        function createPlatform(x, y, w) {
            const geo = new THREE.BoxGeometry(w, 1.5, 2);
            const mat = new THREE.MeshStandardMaterial({ color: currentTheme.platform, roughness: 0.9 });
            const platform = new THREE.Mesh(geo, mat);
            platform.position.set(x, y - 0.75, 0);
            scene.add(platform);
            platforms.push(platform);
        }

        function spawnInitialPlatforms() {
            createPlatform(0, 0, 10); // Start
            nextPlatformX = 10;
            for (let i = 0; i < 15; i++) spawnNextPlatform();
        }

        function spawnNextPlatform() {
            const w = 3 + Math.random() * 4;
            const gap = 4 + Math.random() * 5;
            const y = (Math.random() - 0.5) * 4;
            
            nextPlatformX += gap;
            createPlatform(nextPlatformX, y, w);
        }

        function setupEventListeners() {
            const onKey = (e, val) => {
                switch (e.code) {
                    case 'ArrowLeft': case 'KeyA': moveLeft = val; break;
                    case 'ArrowRight': case 'KeyD': moveRight = val; break;
                    case 'Space': 
                        if (val && canJump && gameActive) { 
                            velocity.y = currentTheme.jumpPower; 
                            canJump = false; 
                        } 
                        break;
                }
            };
            document.addEventListener('keydown', (e) => onKey(e, true));
            document.addEventListener('keyup', (e) => onKey(e, false));
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }

        function checkCollision() {
            let onGround = false;
            const pX = player.position.x;
            const pY = player.position.y;

            for (let plat of platforms) {
                const halfW = plat.geometry.parameters.width / 2;
                if (pX > plat.position.x - halfW - 0.3 && pX < plat.position.x + halfW + 0.3) {
                    const topY = plat.position.y + 0.75;
                    if (pY >= topY - 0.1 && pY <= topY + 0.3 && velocity.y <= 0) {
                        onGround = true;
                        velocity.y = 0;
                        player.position.y = topY;
                        canJump = true;

                        // Score logic
                        let currentScore = Math.floor(pX / 10);
                        if (currentScore > score) {
                            score = currentScore;
                            document.getElementById('score-label').innerText = score;
                            if (platforms.length < score + 20) spawnNextPlatform();
                        }
                    }
                }
            }

            if (pY < -1) takeDamage();
        }

        function takeDamage() {
            hearts--;
            updateHeartsUI();
            if (hearts <= 0) endGame();
            else {
                velocity.set(0, 0);
                // Reset to a safe platform
                let safePlat = platforms.find(p => p.position.x <= player.position.x && p.position.x > player.position.x - 20);
                if (!safePlat) safePlat = platforms[0];
                player.position.set(safePlat.position.x, 5, 0);
            }
        }

        function updateHeartsUI() {
            let hStr = "";
            for(let i=0; i<3; i++) hStr += i < hearts ? '<span class="heart">❤</span> ' : '<span class="heart" style="opacity:0.1">❤</span> ';
            document.getElementById('hearts').innerHTML = hStr;
        }

        function endGame() {
            gameActive = false;
            if(score > bestScore) {
                bestScore = score;
                document.getElementById('best-label').innerText = "Best: " + bestScore;
            }
            document.getElementById('final-score').innerText = score;
            document.getElementById('game-over').style.display = 'block';
        }

        function resetGame() {
            hearts = 3; score = 0; nextPlatformX = 0;
            updateHeartsUI();
            document.getElementById('score-label').innerText = "0";
            document.getElementById('game-over').style.display = 'none';
            platforms.forEach(p => scene.remove(p));
            platforms = [];
            spawnInitialPlatforms();
            player.position.set(0, 2, 0);
            velocity.set(0,0);
            gameActive = true;
        }

        function animate() {
            requestAnimationFrame(animate);
            const time = performance.now();
            const delta = Math.min((time - prevTime) / 1000, 0.1);

            if (gameActive) {
                velocity.y -= currentTheme.gravity * delta; 
                
                const speed = 15;
                let moveDir = (Number(moveRight) - Number(moveLeft));
                player.position.x += moveDir * speed * delta;
                player.position.y += velocity.y * delta;

                // Character Rotation and Squash/Stretch
                if (moveDir !== 0) {
                    playerVisual.rotation.y = moveDir > 0 ? 0 : Math.PI;
                    playerVisual.rotation.z = THREE.MathUtils.lerp(playerVisual.rotation.z, -moveDir * 0.2, 0.1);
                } else {
                    playerVisual.rotation.z = THREE.MathUtils.lerp(playerVisual.rotation.z, 0, 0.1);
                }

                checkCollision();

                // 2D Camera Follow (Locked Z and Y lag)
                const targetX = player.position.x + 4;
                const targetY = THREE.MathUtils.clamp(player.position.y + 2, 2, 8);
                camera.position.x = THREE.MathUtils.lerp(camera.position.x, targetX, 0.1);
                camera.position.y = THREE.MathUtils.lerp(camera.position.y, targetY, 0.05);
                camera.lookAt(camera.position.x, camera.position.y - 1, 0);

                // Lava Scrolling for infinite feel
                lava.position.x = camera.position.x;
                lava.material.emissiveIntensity = 1 + Math.sin(time * 0.005) * 0.5;

                prevTime = time;
            }
            renderer.render(scene, camera);
        }

        window.onload = init;
    </script>
</body>
</html>